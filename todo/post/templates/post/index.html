<head>
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        .button-group {
            height: 40px;
        }
        .button-group > button {
            vertical-align: middle;
        }
        .button-group > .btn-detail, .btn-lift, .btn-fall, .btn-finish {
            display: none;
        }
    </style>
</head>

<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="{% url 'post:index' %}">TODO</a>
        </div>
        <button type="button" class="btn btn-default navbar-btn" onclick="location.href='{% url 'logout' %}?next={% url 'post:index' %}'">로그아웃</button>
    </div>
</nav>

<div class="button-group">
    <button type="button" class="btn btn-warning btn-sm btn-add">추가</button>
    <button type="button" class="btn btn-info btn-sm btn-detail ">상세</button>
    <button type="button" class="btn btn-default btn-sm btn-lift">상승</button>
    <button type="button" class="btn btn-default btn-sm btn-fall">하강</button>
    <button type="button" class="btn btn-danger btn-sm btn-finish">완료</button>
</div>

<div class="container">
    <div class="list-group">
        {% for task in tasks %}
            <li id="{{ task.pk }}" class="list-group-item list-group-item-success clearfix" style="font-size: 25px;">
                {{ task.title }}
            </li>
        {% endfor %}
    </div>
</div>

<script>
    // 모든 button 들을 비활성화 시켜주는 함수
    function hideAllButtonsOfTasks() {
        $(".list-group-item > button").each(function(){
           $(this).hide();
        });
    }

    function removeListGroupItemWarningClass() {
        $(".list-group-item").each(function() {
            $(this).toggleClass("list-group-item-warning", false);
        })
    }

    $('document').ready(function(){
        $(".button-group > .btn-add").show();

        // "완료" button의 click event listener 등록
        $(".btn-finish").each(function(){
            $(this).click(function(){
                var clicked_task = $(".list-group-item-warning");
                if (clicked_task.length > 0) {
                    var id = clicked_task.attr("id");
                    var base_url = "{% url 'post:finish' 12345 %}".replace(/12345/, id);
                    window.location.href = base_url;
                }
            });
        });

        // "상승" button의 click event listener 등록
        $(".btn-lift").each(function(){
            $(this).click(function(){
                var clicked_task = $(".list-group-item-warning");
                if (clicked_task.length > 0) {
                    var command = "{{ BUTTON_LIFT_TAG }}" + "-" + clicked_task.attr("id");
                    var base_url = "{% url 'post:modify' 'command' %}".replace(/command/, command);
                    window.location.href = base_url;
                }
            });
        });

        // "하강" button의 click event listener 등록
        $(".btn-fall").each(function(){
            $(this).click(function(){
                var clicked_task = $(".list-group-item-warning");
                if (clicked_task.length > 0) {
                    var command = "{{ BUTTON_FALL_TAG }}" + "-" + clicked_task.attr("id");
                    var base_url = "{% url 'post:modify' 'command' %}".replace(/command/, command);
                    window.location.href = base_url;
                }
            });
        });

        // list-group-item 들에 button toggling 시키는 click event handler 등록
        $(".list-group-item").each(function(){
            $(this).click(function(e){
                if (e.target == this) {
                    if ($(this).hasClass("list-group-item-warning")) {
                        // 나를 선택 해제하고, 버튼들도 끈다.
                        $(this).toggleClass("list-group-item-warning", false);
                        $(".button-group > button").hide();
                        $(".button-group > .btn-add").show();
                    } else {
                        // 모든 버튼들을 선택 해제하고, 나를 선택하고, 버튼들을 켠다.
                        removeListGroupItemWarningClass();
                        $(this).toggleClass("list-group-item-warning", true);
                        $(".button-group > button").show();
                        $(".button-group > .btn-add").hide();
                    }
                }
            });
        });

        // body의 빈공간에 click event handler 등록
        $("body").click(function(e){
           if(e.target == this) {
               removeListGroupItemWarningClass();
               $(".button-group > button").hide();
               $(".button-group > .btn-add").show();
           }
        });
    })
</script>
</body>